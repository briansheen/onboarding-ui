<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Lab14_StyleIt</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body onload="getTL()">
    <div id="greet">Lab for Brian Sheen</div>
    <button type="button" onclick="getTL()">Refresh Timeline</button>
    <div id="TL"/>
    <script>
      function getTL(){
        document.getElementById("TL").innerHTML = "";
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
          if(xmlHttp.readyState === XMLHttpRequest.DONE){
            if(xmlHttp.status === 200){
              const timelineList = JSON.parse(xmlHttp.responseText);
              for(i = 0; i < timelineList.length; i++) {
                const user = timelineList[i].twitterUser;

                const div = document.createElement("div");
                div.setAttribute("id", "wrapper");

                const msgDiv = document.createElement("div");
                msgDiv.setAttribute("id", "msg");

                const imgDiv = document.createElement("div");
                imgDiv.setAttribute("id", "img");

                const dateDiv = document.createElement("div");
                dateDiv.setAttribute("id", "date");

                const link = document.createElement("a");
                link.setAttribute("target", "_blank");
                link.setAttribute("href", "https://twitter.com/"+user.twitterHandle+"/status/"+timelineList[i].id);

                const img = document.createElement("img");
                img.setAttribute("src", user.profileImageUrl);

                const date = document.createTextNode(new Date(timelineList[i].createdAt));

                const message = document.createTextNode(timelineList[i].message);

                const span = document.createElement("span");

                imgDiv.appendChild(img);
                link.appendChild(message);
                msgDiv.appendChild(link);
                div.appendChild(imgDiv);
                div.appendChild(msgDiv);

                if(i%2 == 1){
                  div.setAttribute("id", "odd");
                } else {
                  div.setAttribute("id", "even");
                }
                document.getElementById("TL").appendChild(div);
              }
            } else {
              document.getElementById("TL").innerHTML = "Error Communicating with localhost:8080";
            }
          }
        }
        xmlHttp.open("GET", "http://localhost:8080/api/1.0/twitter/timeline", true);
        xmlHttp.send();
      }
    </script>
  </body>
</html>
